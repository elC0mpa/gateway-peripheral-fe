(function(e){function a(a){for(var r,i,n=a[0],o=a[1],c=a[2],u=0,b=[];u<n.length;u++)i=n[u],Object.prototype.hasOwnProperty.call(l,i)&&l[i]&&b.push(l[i][0]),l[i]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);d&&d(a);while(b.length)b.shift()();return s.push.apply(s,c||[]),t()}function t(){for(var e,a=0;a<s.length;a++){for(var t=s[a],r=!0,n=1;n<t.length;n++){var o=t[n];0!==l[o]&&(r=!1)}r&&(s.splice(a--,1),e=i(i.s=t[0]))}return e}var r={},l={app:0},s=[];function i(a){if(r[a])return r[a].exports;var t=r[a]={i:a,l:!1,exports:{}};return e[a].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=e,i.c=r,i.d=function(e,a,t){i.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:t})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,a){if(1&a&&(e=i(e)),8&a)return e;if(4&a&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var r in e)i.d(t,r,function(a){return e[a]}.bind(null,r));return t},i.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(a,"a",a),a},i.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},i.p="/gateway-peripheral-fe/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],o=n.push.bind(n);n.push=a,n=n.slice();for(var c=0;c<n.length;c++)a(n[c]);var d=o;s.push([0,"chunk-vendors"]),t()})({0:function(e,a,t){e.exports=t("cd49")},4707:function(e,a,t){},8155:function(e,a,t){"use strict";t("eddf")},"9dd9":function(e,a,t){"use strict";t("4707")},cd49:function(e,a,t){"use strict";t.r(a);var r=t("7a23");function l(e,a,t,l,s,i){const n=Object(r["K"])("GatewaysTable");return Object(r["E"])(),Object(r["k"])(n)}const s=Object(r["n"])("p",null,"No gateway created yet",-1),i=Object(r["o"])("Create gateway");function n(e,a,t,l,n,o){const c=Object(r["K"])("ClusterOutlined"),d=Object(r["K"])("a-button"),u=Object(r["K"])("peripherals-table"),b=Object(r["K"])("PlusOutlined"),p=Object(r["K"])("DeleteOutlined"),O=Object(r["K"])("a-popconfirm"),y=Object(r["K"])("a-table"),j=Object(r["K"])("create-gateway-modal");return Object(r["E"])(),Object(r["m"])(r["b"],null,[Object(r["p"])(y,{columns:e.columns,"data-source":e.gateways,pagination:!1,loading:e.isLoading,"expanded-row-keys":e.expandedRows,rowKey:"serialNumber",scroll:{x:600},class:"gateways-table"},{expandIcon:Object(r["V"])(({expandable:a,expanded:t,record:l})=>[Object(r["p"])(d,{class:Object(r["x"])(["expand-row-button",{"pulsation-button":!t&&!e.rowHasBeenExpanded}]),type:"primary",shape:"circle",onClick:r=>e.toggleRow(a,t,l)},{icon:Object(r["V"])(()=>[Object(r["p"])(c)]),_:2},1032,["class","onClick"])]),expandedRowRender:Object(r["V"])(({record:a})=>[Object(r["p"])(u,{gatewayId:a._id,peripherals:a.peripherals,onRefresh:e.refreshGateways},null,8,["gatewayId","peripherals","onRefresh"])]),headerCell:Object(r["V"])(({column:t})=>["actions"===t.key?(Object(r["E"])(),Object(r["m"])(r["b"],{key:0},[Object(r["p"])(d,{type:"primary",shape:"circle",onClick:a[0]||(a[0]=a=>e.createGatewayModalVisibility=!0),class:"create-gateway-button"},{icon:Object(r["V"])(()=>[Object(r["p"])(b)]),_:1}),Object(r["o"])(" "+Object(r["N"])(t.title),1)],64)):Object(r["l"])("",!0)]),bodyCell:Object(r["V"])(({column:a,record:t})=>["actions"===a.key?(Object(r["E"])(),Object(r["k"])(O,{key:0,title:"Are you sure you want to delete this gateway?",okType:"danger",onConfirm:a=>e.onDeleteGateway(t)},{default:Object(r["V"])(()=>[Object(r["p"])(d,{type:"danger",shape:"circle"},{icon:Object(r["V"])(()=>[Object(r["p"])(p)]),_:1})]),_:2},1032,["onConfirm"])):Object(r["l"])("",!0)]),emptyText:Object(r["V"])(()=>[s,Object(r["p"])(d,{type:"primary",onClick:a[1]||(a[1]=a=>e.createGatewayModalVisibility=!0)},{default:Object(r["V"])(()=>[i]),_:1})]),_:1},8,["columns","data-source","loading","expanded-row-keys"]),Object(r["p"])(j,{isVisible:e.createGatewayModalVisibility,onClose:a[2]||(a[2]=a=>e.createGatewayModalVisibility=!1),onSuccess:e.gatewayCreated},null,8,["isVisible","onSuccess"])],64)}var o=t("bc3a"),c=t.n(o);const d=c.a.create({baseURL:"https://musala-test-be.herokuapp.com/"}),u=()=>new Promise((e,a)=>{d.get("gateway/").then(a=>{const{data:t}=a,{items:r}=t;e(r)}).catch(e=>{e.response?a(e.response.data):e.request&&a(e.request)})}),b=e=>new Promise((a,t)=>{d.delete("gateway/"+e).then(e=>{const{data:t}=e,{items:r}=t;a(r)}).catch(e=>{e.response?t(e.response.data):e.request&&t(e.request)})}),p=(e,a,t)=>new Promise((r,l)=>{d.post("gateway/",{serialNumber:e,address:a,label:t}).then(e=>{const{data:a}=e,{items:t}=a;r(t)}).catch(e=>{e.response?l(e.response.data):e.request&&l(e.request)})}),O=e=>new Promise((a,t)=>{d.delete("peripheral/"+e).then(e=>{const{data:t}=e,{items:r}=t;a(r)}).catch(e=>{e.response?t(e.response.data):e.request&&t(e.request)})}),y=(e,a,t,r)=>new Promise((l,s)=>{d.post("peripheral/",{gateway:e,vendor:a,uid:t,status:r}).then(e=>{const{data:a}=e,{items:t}=a;l(t)}).catch(e=>{e.response?s(e.response.data):e.request&&s(e.request)})}),j=(e,a)=>new Promise((t,r)=>{d.patch("peripheral/"+e,{status:a}).then(e=>{const{data:a}=e,{items:r}=a;t(r)}).catch(e=>{e.response?r(e.response.data):e.request&&r(e.request)})});var m=t("56cd");t("8b35");const h=(e,a,t="")=>{const r={message:a,description:t};"success"===e?m["a"].success(r):"warning"===e?m["a"].warning(r):m["a"].error(r)},f=e=>{const a=[];if(e.error.errors){const{errors:t}=e.error;Object.keys(t).forEach(e=>{a.push(t[e].message)})}return 11e3===e.error.code&&a.push("Serial Number must be unique"),a.join("\n")},g=e=>{const a=new Date(e);return`${a.getDate()}/${a.getMonth()+1}/${a.getFullYear()} ${a.getHours()}:${a.getMinutes()}`};function w(e,a,t,l,s,i){const n=Object(r["K"])("a-input"),o=Object(r["K"])("a-form-item"),c=Object(r["K"])("a-form"),d=Object(r["K"])("modal");return Object(r["E"])(),Object(r["k"])(d,{visible:e.isVisible,"mask-closable":!1,"confirm-loading":e.data.isLoading,title:"Create Gateway",onCancel:e.emitCloseEvent,onOk:e.fieldsValidation},{default:Object(r["V"])(()=>[Object(r["p"])(c,{model:e.data,"label-col":{span:8},"wrapper-col":{span:16},autocomplete:"off",name:"form_in_modal",ref:"formRef"},{default:Object(r["V"])(()=>[Object(r["p"])(o,{label:"Serial Number",name:"uniqueSerialNumber",rules:[{required:!0,message:"Serial Number is required!"}]},{default:Object(r["V"])(()=>[Object(r["p"])(n,{value:e.data.uniqueSerialNumber,"onUpdate:value":a[0]||(a[0]=a=>e.data.uniqueSerialNumber=a),placeholder:"Serial Number","allow-clear":!0,disabled:e.data.isLoading},null,8,["value","disabled"])]),_:1}),Object(r["p"])(o,{label:"Label",name:"label",rules:[{required:!0,message:"Label is required!"}]},{default:Object(r["V"])(()=>[Object(r["p"])(n,{value:e.data.label,"onUpdate:value":a[1]||(a[1]=a=>e.data.label=a),placeholder:"Label","allow-clear":!0,disabled:e.data.isLoading},null,8,["value","disabled"])]),_:1}),Object(r["p"])(o,{label:"IP Address",name:"address",rules:[{required:!0,message:"IP Address is required!"},{validator:e.ipAddressValidation}]},{default:Object(r["V"])(()=>[Object(r["p"])(n,{value:e.data.address,"onUpdate:value":a[2]||(a[2]=a=>e.data.address=a),placeholder:"IP Address","allow-clear":!0,disabled:e.data.isLoading},null,8,["value","disabled"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading","onCancel","onOk"])}t("d9e2");const v=(e,a)=>/^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)(\.(?!$)|$)){4}$/.test(a)||!a.length?Promise.resolve():Promise.reject(new Error("This is not a valid IP Address"));var V=t("ed3b"),k=t("b558"),P=t("3af3"),C=t("322e"),q=(t("cd09"),t("1325"),t("ad26"),Object(r["q"])({name:"CreateGatewayModal",components:{Modal:V["a"],AInput:k["a"],AForm:P["a"],AFormItem:C["a"]},props:{isVisible:{type:Boolean,required:!0}},setup(e,a){const t=Object(r["H"])(),l=Object(r["G"])({uniqueSerialNumber:"",address:"",label:"",isLoading:!1}),s=()=>{var e;l.isLoading||(null===(e=t.value)||void 0===e||e.resetFields(),a.emit("close"))},i=async()=>{try{var e;l.isLoading=!0,await p(l.uniqueSerialNumber,l.address,l.label),h("success","Gateway succesfully created"),null===(e=t.value)||void 0===e||e.resetFields(),a.emit("success")}catch(r){const e=f(r);h("error","Gateway couldnÂ´t be created",e)}finally{l.isLoading=!1}},n=async()=>{try{var e;await(null===(e=t.value)||void 0===e?void 0:e.validateFields()),await i()}catch(a){console.log("Validation error info: ",a)}};return{props:e,emitCloseEvent:s,data:l,fieldsValidation:n,formRef:t,ipAddressValidation:v}}})),_=t("d959"),x=t.n(_);const I=x()(q,[["render",w]]);var S=I;t("caad");const A=Object(r["n"])("p",null,"No peripheral created yet",-1),L=Object(r["o"])("Create peripheral");function K(e,a,t,l,s,i){const n=Object(r["K"])("DeleteOutlined"),o=Object(r["K"])("a-button"),c=Object(r["K"])("a-popconfirm"),d=Object(r["K"])("a-switch"),u=Object(r["K"])("PlusOutlined"),b=Object(r["K"])("a-table"),p=Object(r["K"])("create-peripheral-modal");return Object(r["E"])(),Object(r["m"])(r["b"],null,[Object(r["p"])(b,{columns:e.columns,"data-source":e.peripherals,pagination:!1,loading:e.isLoading,scroll:{x:600},class:"peripherals-table"},{bodyCell:Object(r["V"])(({column:a,record:t})=>["createdAt"===a.key?(Object(r["E"])(),Object(r["m"])(r["b"],{key:0},[Object(r["o"])(Object(r["N"])(e.formatDate(t.createdAt)),1)],64)):Object(r["l"])("",!0),"actions"===a.key?(Object(r["E"])(),Object(r["k"])(c,{key:1,title:"Are you sure you want to delete this peripheral?",okType:"danger",onConfirm:a=>e.onDeletePeripheral(t)},{default:Object(r["V"])(()=>[Object(r["p"])(o,{type:"danger",shape:"circle"},{icon:Object(r["V"])(()=>[Object(r["p"])(n)]),_:1})]),_:2},1032,["onConfirm"])):Object(r["l"])("",!0),"status"===a.key?(Object(r["E"])(),Object(r["k"])(d,{key:2,checked:t.status,"onUpdate:checked":e=>t.status=e,loading:e.updatingStatusIDs.includes(t._id),"checked-children":"ON","un-checked-children":"OFF",onChange:a=>e.onUpdatePeripheralStatus(t)},null,8,["checked","onUpdate:checked","loading","onChange"])):Object(r["l"])("",!0)]),headerCell:Object(r["V"])(({column:t})=>["actions"===t.key?(Object(r["E"])(),Object(r["m"])(r["b"],{key:0},[Object(r["p"])(o,{type:"primary",shape:"circle",onClick:a[0]||(a[0]=a=>e.createPeripheralModalVisibility=!0)},{icon:Object(r["V"])(()=>[Object(r["p"])(u)]),_:1}),Object(r["o"])(" "+Object(r["N"])(t.title),1)],64)):Object(r["l"])("",!0)]),emptyText:Object(r["V"])(()=>[A,Object(r["p"])(o,{type:"primary",onClick:a[1]||(a[1]=a=>e.createPeripheralModalVisibility=!0)},{default:Object(r["V"])(()=>[L]),_:1})]),_:1},8,["columns","data-source","loading"]),Object(r["p"])(p,{isVisible:e.createPeripheralModalVisibility,gatewayId:e.gatewayId,onClose:a[2]||(a[2]=a=>e.createPeripheralModalVisibility=!1),onSuccess:e.peripheralCreated},null,8,["isVisible","gatewayId","onSuccess"])],64)}var M=t("47ce"),E=t("b1c8");function N(e,a,t,l,s,i){const n=Object(r["K"])("a-input"),o=Object(r["K"])("a-form-item"),c=Object(r["K"])("a-switch"),d=Object(r["K"])("a-form"),u=Object(r["K"])("modal");return Object(r["E"])(),Object(r["k"])(u,{visible:e.isVisible,"mask-closable":!1,"confirm-loading":e.data.isLoading,title:"Create Peripheral",onCancel:e.emitCloseEvent,onOk:e.fieldsValidation},{default:Object(r["V"])(()=>[Object(r["p"])(d,{model:e.data,"label-col":{span:8},"wrapper-col":{span:16},autocomplete:"off",name:"form_in_modal",ref:"formRef"},{default:Object(r["V"])(()=>[Object(r["p"])(o,{label:"Vendor",name:"vendor",rules:[{required:!0,message:"Vendor is required!"}]},{default:Object(r["V"])(()=>[Object(r["p"])(n,{value:e.data.vendor,"onUpdate:value":a[0]||(a[0]=a=>e.data.vendor=a),placeholder:"Vendor","allow-clear":!0,disabled:e.data.isLoading},null,8,["value","disabled"])]),_:1}),Object(r["p"])(o,{label:"UID",name:"uid",rules:[{required:!0,message:"UID is required!"}]},{default:Object(r["V"])(()=>[Object(r["p"])(n,{value:e.data.uid,"onUpdate:value":a[1]||(a[1]=a=>e.data.uid=a),placeholder:"UID",type:"number",disabled:e.data.isLoading},null,8,["value","disabled"])]),_:1}),Object(r["p"])(o,{label:"Status",name:"status"},{default:Object(r["V"])(()=>[Object(r["p"])(c,{checked:e.data.status,"onUpdate:checked":a[2]||(a[2]=a=>e.data.status=a),"checked-children":"ON","un-checked-children":"OFF",disabled:e.data.isLoading},null,8,["checked","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading","onCancel","onOk"])}var G=t("160c"),D=(t("99bf"),t("f762"),Object(r["q"])({name:"CreatePeripheralModal",components:{Modal:V["a"],AInput:k["a"],ASwitch:G["a"],AForm:P["a"],AFormItem:C["a"]},props:{isVisible:{type:Boolean,required:!0},gatewayId:{type:String,required:!0}},setup(e,a){const t=Object(r["H"])(),l=Object(r["G"])({vendor:"",uid:"",status:!1,isLoading:!1}),s=()=>{var e;l.isLoading||(null===(e=t.value)||void 0===e||e.resetFields(),a.emit("close"))},i=async()=>{try{var r;l.isLoading=!0,await y(e.gatewayId,l.vendor,Number(l.uid),l.status),h("success","Peripheral succesfully created"),null===(r=t.value)||void 0===r||r.resetFields(),a.emit("success")}catch(s){const e=f(s);h("error","Peripheral couldnÂ´t be created",e)}finally{l.isLoading=!1}},n=async()=>{try{var e;await(null===(e=t.value)||void 0===e?void 0:e.validateFields()),await i()}catch(a){console.log("Validation error info: ",a)}};return{props:e,emitCloseEvent:s,data:l,formRef:t,fieldsValidation:n}}}));const R=x()(D,[["render",N]]);var F=R,U=t("0020"),T=t("5efb"),$=t("768f"),B=(t("5785"),t("84d1"),Object(r["q"])({name:"PeripheralsTable",components:{ATable:U["a"],AButton:T["a"],PlusOutlined:M["a"],DeleteOutlined:E["a"],CreatePeripheralModal:F,ASwitch:G["a"],APopconfirm:$["a"]},props:{peripherals:{type:Array,required:!0},gatewayId:{type:String,required:!0}},emits:["refresh"],setup(e,a){const t=Object(r["G"])({columns:[{title:"Status",dataIndex:"status",key:"status"},{title:"UID",dataIndex:"uid",key:"uid"},{title:"Vendor",dataIndex:"vendor",key:"vendor"},{title:"Created At",dataIndex:"createdAt",key:"createdAt"},{title:"Actions",key:"actions"}],isLoading:!1,createPeripheralModalVisibility:!1,updatingStatusIDs:[]}),l=async()=>{t.createPeripheralModalVisibility=!1,a.emit("refresh")},s=async e=>{try{t.isLoading=!0,await O(e._id),h("success","Peripheral succesfully deleted"),a.emit("refresh")}catch(r){console.log("Error while deleting gateway: ",r)}finally{t.isLoading=!1}},i=async e=>{try{t.updatingStatusIDs.push(e._id),await j(e._id,e.status),h("success","Peripheral status succesfully updated"),a.emit("refresh")}catch{console.log("Error while updating status")}finally{const a=t.updatingStatusIDs.indexOf(e._id);t.updatingStatusIDs.splice(a,1)}};return{...Object(r["Q"])(t),props:e,peripheralCreated:l,onDeletePeripheral:s,formatDate:g,onUpdatePeripheralStatus:i}}}));t("9dd9");const H=x()(B,[["render",K]]);var J=H,Q=t("5265"),Y=Object(r["q"])({name:"GatewaysTable",components:{ATable:U["a"],AButton:T["a"],DeleteOutlined:E["a"],APopconfirm:$["a"],PeripheralsTable:J,CreateGatewayModal:S,PlusOutlined:M["a"],ClusterOutlined:Q["a"]},setup(){const e=Object(r["G"])({columns:[{title:"Serial Number",dataIndex:"serialNumber",key:"serialNumber"},{title:"Label",dataIndex:"label",key:"label"},{title:"IPv4 address",dataIndex:"address",key:"address"},{title:"Actions",key:"actions"}],gateways:[],isLoading:!0,createGatewayModalVisibility:!1,peripheralsModalVisibility:!1,expandedRows:[],rowHasBeenExpanded:!1}),a=async a=>{try{e.isLoading=!0,await b(a._id),h("success","Gateway succesfully deleted"),await t()}catch(r){console.log("Error while deleting gateway: ",r)}finally{e.isLoading=!1}},t=async()=>{try{e.isLoading=!0,e.gateways=await u()}catch(a){console.log("Error while getting gateways")}finally{e.isLoading=!1}},l=async()=>{e.createGatewayModalVisibility=!1,await t()},s=(a,t,r)=>{a&&(e.rowHasBeenExpanded=!0,t?e.expandedRows.splice(e.expandedRows.indexOf(r.serialNumber),1):e.expandedRows.push(r.serialNumber))};return t(),{...Object(r["Q"])(e),onDeleteGateway:a,gatewayCreated:l,refreshGateways:t,toggleRow:s}}});t("8155");const z=x()(Y,[["render",n]]);var W=z,X=Object(r["q"])({name:"App",components:{GatewaysTable:W}});const Z=x()(X,[["render",l]]);var ee=Z;Object(r["j"])(ee).mount("#app")},eddf:function(e,a,t){}});
//# sourceMappingURL=app.b79f6960.js.map